{# templates/noticias/entity_filter.html #}
<!-- Entity filters (if entities exist) -->
{% if entidades %}
<div id="entity-filter-section">
  <div class="text-[9px] text-gray-600 mb-1.5 mono">por entidad:</div>
  <div class="space-y-1.5">
    <select x-model="entity"
            class="w-full border border-gray-400 px-2 py-1 bg-white text-[10px] mono">
      <option value="">seleccionar...</option>
      {% for entidad in entidades %}
        <option value="{{ entidad.id }}">{{ entidad.nombre }}</option>
      {% endfor %}
    </select>
    <div class="flex flex-wrap gap-1.5">
      <button @click="
                if (entity) {
                  if (typeof clearPrimaryFilter === 'function') clearPrimaryFilter();
                  htmx.ajax('GET', '{% url 'timeline' %}?{% if feed_param %}feed=avanzado&{% endif %}filter=mencionan_a&entidad=' + entity, {
                    target: '#timeline-items',
                    swap: 'innerHTML',
                    indicator: '#timeline-skeleton-container'
                  });
                  history.pushState(null, '', '{% url 'timeline' %}?{% if feed_param %}feed=avanzado&{% endif %}filter=mencionan_a&entidad=' + entity);
                }
              "
              :disabled="entity === ''"
              :class="entity === '' ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100'"
              class="border border-gray-400 px-2 py-1 transition-colors text-[10px] mono bg-white">
        todas
      </button>
      <button @click="
                if (entity) {
                  if (typeof clearPrimaryFilter === 'function') clearPrimaryFilter();
                  htmx.ajax('GET', '{% url 'timeline' %}?{% if feed_param %}feed=avanzado&{% endif %}filter=mencionan_positiva&entidad=' + entity, {
                    target: '#timeline-items',
                    swap: 'innerHTML',
                    indicator: '#timeline-skeleton-container'
                  });
                  history.pushState(null, '', '{% url 'timeline' %}?{% if feed_param %}feed=avanzado&{% endif %}filter=mencionan_positiva&entidad=' + entity);
                }
              "
              :disabled="entity === ''"
              :class="entity === '' ? 'opacity-50 cursor-not-allowed' : 'hover:bg-green-50 border-green-600'"
              class="border border-green-600 px-2 py-1 transition-colors text-[10px] mono bg-white">
        positivas
      </button>
      <button @click="
                if (entity) {
                  if (typeof clearPrimaryFilter === 'function') clearPrimaryFilter();
                  htmx.ajax('GET', '{% url 'timeline' %}?{% if feed_param %}feed=avanzado&{% endif %}filter=mencionan_negativa&entidad=' + entity, {
                    target: '#timeline-items',
                    swap: 'innerHTML',
                    indicator: '#timeline-skeleton-container'
                  });
                  history.pushState(null, '', '{% url 'timeline' %}?{% if feed_param %}feed=avanzado&{% endif %}filter=mencionan_negativa&entidad=' + entity);
                }
              "
              :disabled="entity === ''"
              :class="entity === '' ? 'opacity-50 cursor-not-allowed' : 'hover:bg-red-50 border-red-600'"
              class="border border-red-600 px-2 py-1 transition-colors text-[10px] mono bg-white">
        negativas
      </button>
    </div>
  </div>
</div>
{% endif %}
