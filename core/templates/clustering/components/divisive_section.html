<!-- Divisive Section -->
<div class="mb-16">
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-black mb-3 uppercase font-mono tracking-wide">
            Lo que nos Divide
        </h2>
        <p class="text-gray-700 font-mono text-sm">
            Las pocas noticias que realmente polarizan a las burbujas.
        </p>
    </div>

    {% if divisive_news %}
    <!-- Divisive News List -->
    <div class="space-y-4 mb-8">
        {% for item in divisive_news %}
        <div class="border-2 border-black bg-white p-6 hover:bg-gray-50 transition-colors">
            <div class="flex justify-between items-start gap-6">
                <!-- Content -->
                <div class="flex-1">
                    <!-- Polarization Badge -->
                    <div class="mb-3">
                        <span class="inline-block bg-black text-white px-3 py-1 text-xs font-mono uppercase">
                            Polarización: {{ item.polarization_score|floatformat:2 }}
                        </span>
                    </div>

                    <!-- Title -->
                    <h3 class="text-xl font-bold text-black font-mono mb-3">
                        <a href="{% url 'noticia-detail' item.noticia.slug %}" 
                           class="hover:underline">
                            {{ item.noticia.mostrar_titulo }}
                        </a>
                    </h3>

                    <!-- Cluster Disagreement -->
                    <div class="mb-4">
                        <div class="text-xs uppercase text-gray-600 font-mono mb-2">
                            Cómo vota cada burbuja:
                        </div>
                        <div class="flex flex-wrap gap-3">
                            {% for cluster_id, votes in item.cluster_votes.items %}
                            <div class="text-xs font-mono border border-gray-300 p-2">
                                <div class="font-bold mb-1">Burbuja {{ cluster_id }}</div>
                                <div class="space-y-1">
                                    <div class="flex gap-2">
                                        <span class="text-green-700">Buena:</span>
                                        <span class="font-bold">{{ votes.buena|floatformat:0 }}%</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <span class="text-red-700">Mala:</span>
                                        <span class="font-bold">{{ votes.mala|floatformat:0 }}%</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <span class="text-gray-600">Neutral:</span>
                                        <span class="font-bold">{{ votes.neutral|floatformat:0 }}%</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Link -->
                    <a href="{{ item.noticia.enlace }}" 
                       target="_blank"
                       rel="noopener noreferrer"
                       class="text-xs uppercase font-mono text-black hover:underline">
                        Leer artículo →
                    </a>
                </div>

                <!-- Visual indicator -->
                <div class="w-24 flex-shrink-0">
                    <div class="h-24 border-2 border-black relative overflow-hidden">
                        <!-- Simple bar showing polarization -->
                        <div class="absolute inset-0 flex">
                            {% for cluster_id, votes in item.cluster_votes.items %}
                            {% if votes.buena > votes.mala %}
                            <div class="bg-gray-200" style="width: calc(100% / {{ item.cluster_votes|length }})"></div>
                            {% else %}
                            <div class="bg-black" style="width: calc(100% / {{ item.cluster_votes|length }})"></div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="text-xs text-center font-mono text-gray-600 mt-1">
                        División visual
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Polarization Timeline -->
    {% if polarization_timeline %}
    <div class="border-2 border-black bg-white p-6 mt-8">
        <h3 class="text-xl font-bold text-black mb-4 uppercase font-mono">
            Evolución de la Polarización
        </h3>
        <p class="text-sm text-gray-700 font-mono mb-6">
            ¿La sociedad uruguaya se polariza más o menos con el tiempo?
        </p>
        
        <div id="polarization-timeline-chart" style="height: 400px;"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const timelineData = {{ polarization_timeline|safe }};
        
        if (timelineData && timelineData.length > 0) {
            // Extract dates and metrics
            const dates = timelineData.map(d => d.date);
            const polarization = timelineData.map(d => d.polarization_score);
            const consensus = timelineData.map(d => d.consensus_score);
            
            const traces = [
                {
                    x: dates,
                    y: polarization,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Polarización',
                    line: { color: '#000000', width: 3 },
                    marker: { size: 8, color: '#000000' },
                },
                {
                    x: dates,
                    y: consensus,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Consenso',
                    line: { color: '#666666', width: 3, dash: 'dash' },
                    marker: { size: 8, color: '#666666' },
                }
            ];
            
            const layout = {
                xaxis: {
                    title: 'Fecha',
                    type: 'date',
                },
                yaxis: {
                    title: 'Score (0-1)',
                    range: [0, 1],
                },
                hovermode: 'x unified',
                showlegend: true,
                legend: {
                    x: 0,
                    y: 1,
                },
                margin: { l: 60, r: 30, t: 30, b: 60 },
                font: {
                    family: 'IBM Plex Mono, monospace',
                    size: 12,
                },
                plot_bgcolor: '#FFFFFF',
                paper_bgcolor: '#FFFFFF',
            };
            
            const config = {
                responsive: true,
                displayModeBar: false,
            };
            
            Plotly.newPlot('polarization-timeline-chart', traces, layout, config);
        }
    });
    </script>
    {% endif %}

    {% else %}
    <div class="border-2 border-black p-8 bg-gray-50">
        <p class="text-gray-700 font-mono text-center">
            No hay datos de polarización disponibles
        </p>
    </div>
    {% endif %}
</div>
